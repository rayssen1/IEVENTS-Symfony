{% extends 'baya.html.twig' %}
{% block body_class %}no-bg{% endblock %}

{% block body %}
<style>
    body.no-bg {
        background: none;
        background-color: rgb(215, 210, 210);
    }

    .form-container {
        max-width: 600px;
        margin: 100px auto 50px auto;
        padding: 30px;
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    .form-container h3 {
        text-align: center;
        margin-bottom: 20px;
    }

    .form-container form div {
        margin-bottom: 20px;
    }

    .form-container input,
    .form-container select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .form-buttons {
        display: flex;
        justify-content: center;
        gap: 20px;
    }

    .form-buttons button,
    .form-buttons input[type="submit"],
    .form-buttons a {
        background-color: #c5eff7;
        color: white;
        padding: 10px 25px;
        border: none;
        border-radius: 4px;
        text-decoration: none;
        font-weight: bold;
    }

    .form-buttons button:hover,
    .form-buttons input[type="submit"]:hover,
    .form-buttons a:hover {
        background-color: #33a6e6;
    }

    .error-message {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
</style>

<header id="header">
    <div id="menu" class="header-menu fixed">
        <div class="box">
            <div class="row">
                <nav role="navigation" class="col-sm-12">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <span class="navbar-brand logo">I-EVENTS</span>
                    </div>
                    <div class="navbar-collapse collapse">
                        <ul class="nav navbar-nav">
                            <li class="current"><a href="#header">Home</a></li>
                            <li><a href="#about">About us</a></li>
                            <li><a href="/reservation">Mes Reservations</a></li>
                            <li><a href="/reclamation/new">Reclamation</a></li>
                            <li><a href="#prices">Pricing</a></li>
                            {% if app.session.get('session_key') %}
                                <li><a href="{{ path('app_user_edit', {'id': app.session.get('user_id')}) }}">Profile</a></li>
                                <li><a href="/logout">Log out</a></li>
                            {% else %}
                                <li><a href="/authentication">Sign In</a></li>
                                <li><a href="/user/new">Sign Up</a></li>
                            {% endif %}
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</header>

<div class="form-container">
    <h3>Modifier la réservation</h3>

    {% if event is defined %}
    <div class="card mb-4">
        <div class="card-header">
            <h4>Détails de l'événement</h4>
        </div>
        <div class="card-body">
            <h5>{{ event.titre }}</h5>
            <p><strong>Date:</strong> {{ event.dateEvent|date('d/m/Y') }}</p>
            <p><strong>Lieu:</strong> {{ event.lieu }}</p>
            <p><strong>Prix de base:</strong> {{ event.prix }} €</p>
            <p><strong>Places disponibles:</strong> {{ event.nbPlace }}</p>
        </div>
    </div>
    {% endif %}

    {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                {{ form_label(form.ticketType) }}
                {{ form_widget(form.ticketType, {'attr': {'class': 'form-control'}}) }}
                {% if form.ticketType.vars.valid == false %}
                    <div class="error-message">
                        {{ form_errors(form.ticketType) }}
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                {{ form_label(form.ticketCount) }}
                {{ form_widget(form.ticketCount, {'attr': {'class': 'form-control'}}) }}
                {% if form.ticketCount.vars.valid == false %}
                    <div class="error-message">
                        {{ form_errors(form.ticketCount) }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                {{ form_label(form.totalPrice) }}
                {{ form_widget(form.totalPrice, {'attr': {'class': 'form-control'}}) }}
                {% if form.totalPrice.vars.valid == false %}
                    <div class="error-message">
                        {{ form_errors(form.totalPrice) }}
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                {{ form_label(form.status) }}
                {{ form_widget(form.status, {'attr': {'class': 'form-control'}}) }}
                {% if form.status.vars.valid == false %}
                    <div class="error-message">
                        {{ form_errors(form.status) }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="form-buttons">
        <input type="submit" value="Modifier">
        <a href="{{ path('app_reservation_index') }}">Retour à la liste</a>
    </div>
    {{ form_end(form) }}

    <div class="form-buttons">
        {{ include('reservation/_delete_form.html.twig') }}
    </div>
</div>

{% if event is defined %}
{% block javascripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ticketTypeSelect = document.getElementById('{{ form.ticketType.vars.id }}');
        const ticketCountInput = document.getElementById('{{ form.ticketCount.vars.id }}');
        const totalPriceInput = document.getElementById('{{ form.totalPrice.vars.id }}');
        const basePrice = {{ event.prix|default(0) }};

        function updateTotalPrice() {
            const ticketType = ticketTypeSelect.value;
            const ticketCount = parseInt(ticketCountInput.value) || 0;

            let multiplier = 1.0;
            switch (ticketType) {
                case 'VIP':
                    multiplier = 2.0;
                    break;
                case 'BASIC':
                    multiplier = 1.0;
                    break;
                case 'KID':
                    multiplier = 0.5;
                    break;
            }

            const totalPrice = basePrice * ticketCount * multiplier;
            totalPriceInput.value = totalPrice.toFixed(2);
        }

        ticketTypeSelect.addEventListener('change', updateTotalPrice);
        ticketCountInput.addEventListener('input', updateTotalPrice);
        updateTotalPrice(); // on load
    });
</script>
{% endblock %}
{% endif %}
{% endblock %}
